<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title><%= title %></title>
  <style>
    .navbar{display:flex;flex-wrap:wrap;gap:12px;align-items:center;padding:8px 0;}
    .navbar form{margin:0;}

    /* Uniform-height "buttons" for both links and real buttons */
    .navbtn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-height:44px;
      padding:0 12px;
      border:1px solid #999;
      background:#f6f6f6;
      border-radius:6px;
      text-decoration:none;
      color:#000;
      font:inherit;
      line-height:1.1;
      cursor:pointer;
      box-sizing:border-box;
      user-select:none;
    }
    .nav-notice {
      margin-left: 1em;
      color: #c00;
      font-weight: bold;
    }
    a.navbtn:hover, button.navbtn:hover{background:#ececec;}
    button.navbtn{appearance:none;-webkit-appearance:none;}

    .navbtn--wide{padding:0 14px;}
    .navbtn small{font-size:0.8em;opacity:0.8;}

    .notice{padding:8px 10px;border:1px solid #f3c15a;background:#fff7e0;border-radius:6px;}
  </style>
</head>
<body>
  <div class="navbar">
      % my $ts = stash('local_cache_mtime') // app->defaults->{local_cache_mtime} // 0;
      % my $label = $ts ? scalar(localtime($ts)) : 'never';

    <a class="navbtn" href="/">Home</a>
    <a class="navbtn" href="/qbt/hashnames">QBT hash-names</a>
    <a class="navbtn" href="/qbt/repairable">Repairable</a>
    <a class="navbtn" href="/qbt/triage">Triage</a>
    <a class="navbtn" href="/torrents">Page View</a>
    <a class="navbtn" href="/qbt/add_one">Single View</a>
    <a class="navbtn" href="/qbt/no_hits">No Hits</a>

    % if (app->defaults->{local_cache}{rebuilding}) {
        <span class="nav-notice">Rebuilding local cache…</span>
    % }
    % if (stash('dev_mode')) {
    % my $notice = stash('notice') // flash('notice');
    % if ($notice) {
  <div class="notice"><%= $notice %></div>
    % }

<form method="post" action="/localcache/rebuild">
  <input type="hidden" name="tok" value="<%= stash('rebuild_tok') // '' %>">
  <button class="navbtn navbtn--wide" type="submit">Rebuild Cache<br>
    <small>Last: <%= $label %></small>
  </button>
</form>

      <form method="post" action="/tasks/poll">
        <button class="navbtn navbtn--wide" type="submit">Poll recheck → maybe resume</button>
      </form>


      <form method="post" action="/restart">
        <button class="navbtn" type="submit">Restart server (dev)</button>
      </form>
    % }
  </div>

  <hr />

  <%= content %>
</body>
</html>
